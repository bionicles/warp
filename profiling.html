<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Runtime Reference" href="modules/runtime.html" /><link rel="prev" title="Concurrency" href="modules/concurrency.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.01.29 -->
        <title>Profiling - Warp 1.3.0</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=a91381f3" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --admonition-title-font-size: 100%;
  --admonition-font-size: 100%;
  --color-api-pre-name: #4e9a06;
  --color-api-name: #4e9a06;
  --color-admonition-title--seealso: #ffffff;
  --color-admonition-title-background--seealso: #448aff;
  --color-admonition-title-background--note: #76b900;
  --color-admonition-title--note: #ffffff;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-admonition-title-background--note: #76b900;
  --color-admonition-title--note: #ffffff;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-admonition-title-background--note: #76b900;
  --color-admonition-title--note: #ffffff;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Warp 1.3.0</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="_static/logo-light-mode.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="_static/logo-dark-mode.png" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Warp 1.3.0</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">User's Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/devices.html">Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/differentiability.html">Differentiability</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/generics.html">Generics</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/interoperability.html">Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="limitations.html">Limitations</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Topics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="modules/allocators.html">Allocators</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/concurrency.html">Concurrency</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Profiling</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Core Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules/runtime.html">Runtime Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/functions.html">Kernel Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Simulation Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules/sim.html">warp.sim</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/sparse.html">warp.sparse</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/fem.html">warp.fem</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/render.html">warp.render</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/NVIDIA/warp">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/warp-lang">PyPI</a></li>
<li class="toctree-l1"><a class="reference external" href="https://discord.com/channels/827959428476174346/953756751977648148">Discord</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="profiling">
<h1>Profiling<a class="headerlink" href="#profiling" title="Link to this heading">#</a></h1>
<section id="scopedtimer">
<h2>ScopedTimer<a class="headerlink" href="#scopedtimer" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">wp.ScopedTimer</span></code> objects can be used to gain some basic insight into the performance of Warp applications:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@wp</span><span class="o">.</span><span class="n">kernel</span>
<span class="k">def</span> <span class="nf">inc_loop</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">wp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">num_iters</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">wp</span><span class="o">.</span><span class="n">tid</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_iters</span><span class="p">):</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">10_000_000</span>
<span class="n">devices</span> <span class="o">=</span> <span class="n">wp</span><span class="o">.</span><span class="n">get_cuda_devices</span><span class="p">()</span>

<span class="c1"># pre-allocate host arrays for readback</span>
<span class="n">host_arrays</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">wp</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="n">pinned</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">devices</span>
<span class="p">]</span>

<span class="c1"># code for profiling</span>
<span class="k">with</span> <span class="n">wp</span><span class="o">.</span><span class="n">ScopedTimer</span><span class="p">(</span><span class="s2">&quot;Demo&quot;</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">device</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">devices</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">wp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
        <span class="n">wp</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="n">inc_loop</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="mi">500</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
        <span class="n">wp</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="n">inc_loop</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
        <span class="n">wp</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="n">inc_loop</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="mi">1500</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
        <span class="n">wp</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">host_arrays</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<p>The only required argument for the <code class="docutils literal notranslate"><span class="pre">ScopedTimer</span></code> constructor is a string label, which can be used to distinguish multiple timed code sections when reading the output.  The snippet above will print a message like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Demo took 0.52 ms</span>
</pre></div>
</div>
<p>By default, <code class="docutils literal notranslate"><span class="pre">ScopedTimer</span></code> measures the elapsed time on the CPU and does not introduce any CUDA synchronization.  Since most CUDA operations are asynchronous, the result does not include the time spent executing kernels and memory transfers on the CUDA device.  It’s still a useful measurement, because it shows how long it took to schedule the CUDA operations on the CPU.</p>
<p>To get the total amount of time including the device executions time, create the <code class="docutils literal notranslate"><span class="pre">ScopedTimer</span></code> with the <code class="docutils literal notranslate"><span class="pre">synchronize=True</span></code> flag.  This is equivalent to calling <code class="docutils literal notranslate"><span class="pre">wp.synchronize()</span></code> before and after the timed section of code.  Synchronizing at the beginning ensures that all prior CUDA work has completed prior to starting the timer.  Synchronizing at the end ensures that all timed work finishes before stopping the timer.  With the example above, the result might look like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Demo took 4.91 ms</span>
</pre></div>
</div>
<p>The timing values will vary slightly from run to run and will depend on the system hardware and current load.  The sample results presented here were obtained on a system with one RTX 4090 GPU, one RTX 3090 GPU, and an AMD Ryzen Threadripper Pro 5965WX CPU.  For each GPU, the code allocates and initializes an array with 10 million floating point elements.  It then launches the <code class="docutils literal notranslate"><span class="pre">inc_loop</span></code> kernel three times on the array.  The kernel increments each array element a given number of times - 500, 1000, and 1500.  Finally, the code copies the array contents to the CPU.</p>
<p>Profiling complex programs with many asynchronous and concurrent operations can be tricky.  Profiling tools like <a class="reference external" href="https://developer.nvidia.com/nsight-systems">NVIDIA Nsight Systems</a> can present the results in a visual way and capture a plethora of timing information for deeper study.  For profiling tools capable of visualizing NVTX ranges, <code class="docutils literal notranslate"><span class="pre">ScopedTimer</span></code> can be created with the <code class="docutils literal notranslate"><span class="pre">use_nvtx=True</span></code> argument.  This will mark the CPU execution range on the timeline for easier visual inspection.  The color can be customized using the <code class="docutils literal notranslate"><span class="pre">color</span></code> argument, as shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">wp</span><span class="o">.</span><span class="n">ScopedTimer</span><span class="p">(</span><span class="s2">&quot;Demo&quot;</span><span class="p">,</span> <span class="n">use_nvtx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>To use NVTX integration, you will need to install the <a class="reference external" href="https://github.com/NVIDIA/NVTX/tree/release-v3/python">NVIDIA NVTX Python package</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">nvtx</span>
</pre></div>
</div>
<p>The package allows you to insert custom NVTX ranges into your code (<code class="docutils literal notranslate"><span class="pre">nvtx.annotate</span></code>) and customize the <a class="reference external" href="https://github.com/NVIDIA/NVTX/blob/release-v3/python/nvtx/colors.py">colors</a>.</p>
<p>Here is what the demo code looks like in Nsight Systems (click to enlarge the image):</p>
<a class="reference internal image-reference" href="_images/profiling_nosync.png"><img alt="_images/profiling_nosync.png" class="align-center" src="_images/profiling_nosync.png" style="width: 95%;" /></a>
<p>There are a few noteworthy observations we can make from this capture.  Scheduling and launching the work on the CPU takes about half a millisecond, as shown in the <cite>NVTX / Start &amp; End</cite> row.  This time also includes the allocation of arrays on both CUDA devices.  We can see that the execution on each device is asynchronous with respect to the host, since CUDA operations start running before the yellow <cite>Demo</cite> NVTX range finishes.  We can also see that the operations on different CUDA devices execute concurrently, including kernels and memory transfers.  The kernels run faster on the first CUDA device (RTX 4090) than the second device (RTX 3090).  Memory transfers take about the same time on each device.  Using pinned CPU arrays for the transfer destinations allows the transfers to run asynchronously without involving the CPU.</p>
<p>Check out the <a class="reference internal" href="modules/concurrency.html"><span class="doc">concurrency documentation</span></a> for more information about asynchronous operations.</p>
<p>Note that synchronization was not enabled in this run, so the NVTX range only spans the CPU operations used to schedule the CUDA work.  When synchronization is enabled, the timer will wait for all CUDA work to complete, so the NVTX range will span the synchronization of both devices:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">wp</span><span class="o">.</span><span class="n">ScopedTimer</span><span class="p">(</span><span class="s2">&quot;Demo&quot;</span><span class="p">,</span> <span class="n">use_nvtx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">synchronize</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/profiling_sync.png"><img alt="_images/profiling_sync.png" class="align-center" src="_images/profiling_sync.png" style="width: 95%;" /></a>
</section>
<section id="cuda-activity-profiling">
<h2>CUDA Activity Profiling<a class="headerlink" href="#cuda-activity-profiling" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ScopedTimer</span></code> supports timing individual CUDA activities like kernels and memory operations.  This is done by measuring the time taken between <a class="reference internal" href="modules/concurrency.html#cuda-events"><span class="std std-ref">CUDA events</span></a> on the device.  To get information about CUDA activities, pass the <code class="docutils literal notranslate"><span class="pre">cuda_filter</span></code> argument to the <code class="docutils literal notranslate"><span class="pre">ScopedTimer</span></code> constructor.  The <code class="docutils literal notranslate"><span class="pre">cuda_filter</span></code> can be a bitwise combination of the following values:</p>
<div class="table-wrapper colwidths-given docutils container" id="id1">
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">CUDA profiling flags</span><a class="headerlink" href="#id1" title="Link to this table">#</a></caption>
<colgroup>
<col style="width: 33.3%" />
<col style="width: 66.7%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">wp.TIMING_KERNELS</span></code></p></td>
<td><p>Warp kernels (this includes all kernels written in Python as <code class="docutils literal notranslate"><span class="pre">&#64;wp.kernel</span></code>)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">wp.TIMING_KERNELS_BUILTIN</span></code></p></td>
<td><p>Builtin kernels (this includes kernels used by the Warp library under the hood)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">wp.TIMING_MEMCPY</span></code></p></td>
<td><p>CUDA memory transfers (host-to-device, device-to-host, device-to-device, and peer-to-peer)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">wp.TIMING_MEMSET</span></code></p></td>
<td><p>CUDA memset operations (e.g., zeroing out memory in <code class="docutils literal notranslate"><span class="pre">wp.zeros()</span></code>)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">wp.TIMING_GRAPH</span></code></p></td>
<td><p>CUDA graph launches</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">wp.TIMING_ALL</span></code></p></td>
<td><p>Combines all of the above for convenience.</p></td>
</tr>
</tbody>
</table>
</div>
<p>When a non-zero <code class="docutils literal notranslate"><span class="pre">cuda_filter</span></code> is specified, Warp will inject CUDA events for timing purposes and report the results when the <code class="docutils literal notranslate"><span class="pre">ScopeTimer</span></code> finishes.  This adds some overhead to the code, so should be used only during profiling.</p>
<p>CUDA event timing resolution is about 0.5 microseconds.  The reported execution time of short operations will likely be longer than the operations actually took on the device.  This is due to the timing resolution and the overhead of added instrumentation code.  For more precise analysis of short operations, a tool like Nsight Systems can report more accurate data.</p>
<p>Enabling CUDA profiling with the demo code can be done like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">wp</span><span class="o">.</span><span class="n">ScopedTimer</span><span class="p">(</span><span class="s2">&quot;Demo&quot;</span><span class="p">,</span> <span class="n">cuda_filter</span><span class="o">=</span><span class="n">wp</span><span class="o">.</span><span class="n">TIMING_ALL</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>This adds additional information to the output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CUDA</span> <span class="n">timeline</span><span class="p">:</span>
<span class="o">----------------+---------+------------------------</span>
<span class="n">Time</span>            <span class="o">|</span> <span class="n">Device</span>  <span class="o">|</span> <span class="n">Activity</span>
<span class="o">----------------+---------+------------------------</span>
    <span class="mf">0.021504</span> <span class="n">ms</span> <span class="o">|</span> <span class="n">cuda</span><span class="p">:</span><span class="mi">0</span>  <span class="o">|</span> <span class="n">memset</span>
    <span class="mf">0.163840</span> <span class="n">ms</span> <span class="o">|</span> <span class="n">cuda</span><span class="p">:</span><span class="mi">0</span>  <span class="o">|</span> <span class="n">forward</span> <span class="n">kernel</span> <span class="n">inc_loop</span>
    <span class="mf">0.306176</span> <span class="n">ms</span> <span class="o">|</span> <span class="n">cuda</span><span class="p">:</span><span class="mi">0</span>  <span class="o">|</span> <span class="n">forward</span> <span class="n">kernel</span> <span class="n">inc_loop</span>
    <span class="mf">0.451584</span> <span class="n">ms</span> <span class="o">|</span> <span class="n">cuda</span><span class="p">:</span><span class="mi">0</span>  <span class="o">|</span> <span class="n">forward</span> <span class="n">kernel</span> <span class="n">inc_loop</span>
    <span class="mf">2.455520</span> <span class="n">ms</span> <span class="o">|</span> <span class="n">cuda</span><span class="p">:</span><span class="mi">0</span>  <span class="o">|</span> <span class="n">memcpy</span> <span class="n">DtoH</span>
    <span class="mf">0.051200</span> <span class="n">ms</span> <span class="o">|</span> <span class="n">cuda</span><span class="p">:</span><span class="mi">1</span>  <span class="o">|</span> <span class="n">memset</span>
    <span class="mf">0.374784</span> <span class="n">ms</span> <span class="o">|</span> <span class="n">cuda</span><span class="p">:</span><span class="mi">1</span>  <span class="o">|</span> <span class="n">forward</span> <span class="n">kernel</span> <span class="n">inc_loop</span>
    <span class="mf">0.707584</span> <span class="n">ms</span> <span class="o">|</span> <span class="n">cuda</span><span class="p">:</span><span class="mi">1</span>  <span class="o">|</span> <span class="n">forward</span> <span class="n">kernel</span> <span class="n">inc_loop</span>
    <span class="mf">1.042432</span> <span class="n">ms</span> <span class="o">|</span> <span class="n">cuda</span><span class="p">:</span><span class="mi">1</span>  <span class="o">|</span> <span class="n">forward</span> <span class="n">kernel</span> <span class="n">inc_loop</span>
    <span class="mf">2.136096</span> <span class="n">ms</span> <span class="o">|</span> <span class="n">cuda</span><span class="p">:</span><span class="mi">1</span>  <span class="o">|</span> <span class="n">memcpy</span> <span class="n">DtoH</span>

<span class="n">CUDA</span> <span class="n">activity</span> <span class="n">summary</span><span class="p">:</span>
<span class="o">----------------+---------+------------------------</span>
<span class="n">Total</span> <span class="n">time</span>      <span class="o">|</span> <span class="n">Count</span>   <span class="o">|</span> <span class="n">Activity</span>
<span class="o">----------------+---------+------------------------</span>
    <span class="mf">0.072704</span> <span class="n">ms</span> <span class="o">|</span>       <span class="mi">2</span> <span class="o">|</span> <span class="n">memset</span>
    <span class="mf">3.046400</span> <span class="n">ms</span> <span class="o">|</span>       <span class="mi">6</span> <span class="o">|</span> <span class="n">forward</span> <span class="n">kernel</span> <span class="n">inc_loop</span>
    <span class="mf">4.591616</span> <span class="n">ms</span> <span class="o">|</span>       <span class="mi">2</span> <span class="o">|</span> <span class="n">memcpy</span> <span class="n">DtoH</span>

<span class="n">CUDA</span> <span class="n">device</span> <span class="n">summary</span><span class="p">:</span>
<span class="o">----------------+---------+------------------------</span>
<span class="n">Total</span> <span class="n">time</span>      <span class="o">|</span> <span class="n">Count</span>   <span class="o">|</span> <span class="n">Device</span>
<span class="o">----------------+---------+------------------------</span>
    <span class="mf">3.398624</span> <span class="n">ms</span> <span class="o">|</span>       <span class="mi">5</span> <span class="o">|</span> <span class="n">cuda</span><span class="p">:</span><span class="mi">0</span>
    <span class="mf">4.312096</span> <span class="n">ms</span> <span class="o">|</span>       <span class="mi">5</span> <span class="o">|</span> <span class="n">cuda</span><span class="p">:</span><span class="mi">1</span>
<span class="n">Demo</span> <span class="n">took</span> <span class="mf">0.92</span> <span class="n">ms</span>
</pre></div>
</div>
<p>The first section is the <cite>CUDA timeline</cite>, which lists all captured activities in issue order.  We see a <cite>memset</cite> on device <code class="docutils literal notranslate"><span class="pre">cuda:0</span></code>, which corresponds to clearing the memory in <code class="docutils literal notranslate"><span class="pre">wp.zeros()</span></code>.  This is followed by three launches of the <code class="docutils literal notranslate"><span class="pre">inc_loop</span></code> kernel on <code class="docutils literal notranslate"><span class="pre">cuda:0</span></code> and a memory transfer from device to host issued by <code class="docutils literal notranslate"><span class="pre">wp.copy()</span></code>.  The remaining entries repeat similar operations on device <code class="docutils literal notranslate"><span class="pre">cuda:1</span></code>.</p>
<p>The next section is the <cite>CUDA activity summary</cite>, which reports the cumulative time taken by each activity type.  Here, the <cite>memsets</cite>, kernel launches, and memory transfer operations are grouped together.  This is a good way to see where time is being spent overall.  The <cite>memsets</cite> are quite fast.  The <code class="docutils literal notranslate"><span class="pre">inc_loop</span></code> kernel launches took about three milliseconds of combined GPU time.  The memory transfers took the longest, over four milliseconds.</p>
<p>The <cite>CUDA device summary</cite> shows the total time taken per device.  We see that device <code class="docutils literal notranslate"><span class="pre">cuda:0</span></code> took about 3.4 ms to complete the tasks and device <code class="docutils literal notranslate"><span class="pre">cuda:1</span></code> took about 4.3 ms.  This summary can be used to asses the workload distribution in multi-GPU applications.</p>
<p>The final line shows the time taken by the CPU, as with the default <code class="docutils literal notranslate"><span class="pre">ScopedTimer</span></code> options (without synchronization in this case).</p>
<section id="customizing-the-output">
<h3>Customizing the output<a class="headerlink" href="#customizing-the-output" title="Link to this heading">#</a></h3>
<p>It is possible to customize how the activity timing results are reported.  The function <a class="reference internal" href="#warp.timing_print" title="warp.timing_print"><code class="xref py py-func docutils literal notranslate"><span class="pre">warp.timing_print()</span></code></a> is used by default.  To use a different reporting function, pass it as the <code class="docutils literal notranslate"><span class="pre">report_func</span></code> argument to <code class="docutils literal notranslate"><span class="pre">ScopedTimer</span></code>.  The custom report function should take a list of <a class="reference internal" href="#warp.TimingResult" title="warp.TimingResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">warp.TimingResult</span></code></a> objects as the first argument.  Each result in the list corresponds to a single activity and the list represents the complete recorded timeline.  By manually traversing the list, you can customize the formatting of the output, apply custom sorting rules, and aggregate the results as desired.  The second argument is a string indent that should be printed at the beginning of each line.  This is for compatibility with <code class="docutils literal notranslate"><span class="pre">ScopedTimer</span></code> indenting rules used with nested timers.</p>
<p>Here is an example of a custom reporting function, which aggregates the total time spend in forward and backward kernels:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_custom_report</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="n">forward_time</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">backward_time</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="c1"># aggregate all forward kernels</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;forward kernel&quot;</span><span class="p">):</span>
            <span class="n">forward_time</span> <span class="o">+=</span> <span class="n">r</span><span class="o">.</span><span class="n">elapsed</span>
        <span class="c1"># aggregate all backward kernels</span>
        <span class="k">elif</span> <span class="n">r</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;backward kernel&quot;</span><span class="p">):</span>
            <span class="n">backward_time</span> <span class="o">+=</span> <span class="n">r</span><span class="o">.</span><span class="n">elapsed</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="si">}</span><span class="s2">Forward kernels  : </span><span class="si">{</span><span class="n">forward_time</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="si">}</span><span class="s2">Backward kernels : </span><span class="si">{</span><span class="n">backward_time</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s apply it to one of the Warp examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">warp.examples.optim.example_cloth_throw</span> <span class="kn">import</span> <span class="n">Example</span>

<span class="n">example</span> <span class="o">=</span> <span class="n">Example</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="n">example</span><span class="o">.</span><span class="n">use_graph</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># disable graphs so we get timings for individual kernels</span>

<span class="k">with</span> <span class="n">wp</span><span class="o">.</span><span class="n">ScopedTimer</span><span class="p">(</span><span class="s2">&quot;Example&quot;</span><span class="p">,</span> <span class="n">cuda_filter</span><span class="o">=</span><span class="n">wp</span><span class="o">.</span><span class="n">TIMING_KERNEL</span><span class="p">,</span> <span class="n">report_func</span><span class="o">=</span><span class="n">print_custom_report</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">example</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</pre></div>
</div>
<p>This produces a report like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Forward</span> <span class="n">kernels</span>  <span class="p">:</span> <span class="mf">187.098367</span> <span class="n">ms</span>
<span class="n">Backward</span> <span class="n">kernels</span> <span class="p">:</span> <span class="mf">245.070177</span> <span class="n">ms</span>
</pre></div>
</div>
</section>
<section id="using-the-activity-timing-functions-directly">
<h3>Using the activity timing functions directly<a class="headerlink" href="#using-the-activity-timing-functions-directly" title="Link to this heading">#</a></h3>
<p>It is also possible to capture activity timings without using the <code class="docutils literal notranslate"><span class="pre">ScopedTimer</span></code> at all.  Simply call <a class="reference internal" href="#warp.timing_begin" title="warp.timing_begin"><code class="xref py py-func docutils literal notranslate"><span class="pre">warp.timing_begin()</span></code></a> to start recording activity timings and <a class="reference internal" href="#warp.timing_end" title="warp.timing_end"><code class="xref py py-func docutils literal notranslate"><span class="pre">warp.timing_end()</span></code></a> to stop and get a list of recorded activities.  You can use <a class="reference internal" href="#warp.timing_print" title="warp.timing_print"><code class="xref py py-func docutils literal notranslate"><span class="pre">warp.timing_print()</span></code></a> to print the default activity report or generate your own report from the list of results.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">wp</span><span class="o">.</span><span class="n">timing_begin</span><span class="p">(</span><span class="n">cuda_filter</span><span class="o">=</span><span class="n">wp</span><span class="o">.</span><span class="n">TIMING_ALL</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">wp</span><span class="o">.</span><span class="n">timing_end</span><span class="p">()</span>

<span class="n">wp</span><span class="o">.</span><span class="n">timing_print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="limitations">
<h3>Limitations<a class="headerlink" href="#limitations" title="Link to this heading">#</a></h3>
<p>Currently, detailed activity timing is only available for CUDA devices, but support for CPU timing may be added in the future.</p>
<p>The activity profiling only records activities initiated using the Warp API.  It does not capture CUDA activity initiated by other frameworks.  A profiling tool like Nsight Systems can be used to examine whole program activities.</p>
</section>
</section>
<section id="using-cuda-events">
<h2>Using CUDA Events<a class="headerlink" href="#using-cuda-events" title="Link to this heading">#</a></h2>
<p>CUDA events can be used for timing purposes outside of the <code class="docutils literal notranslate"><span class="pre">ScopedTimer</span></code>.  Here is an example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">wp</span><span class="o">.</span><span class="n">ScopedDevice</span><span class="p">(</span><span class="s2">&quot;cuda:0&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">device</span><span class="p">:</span>

    <span class="c1"># ensure the module is loaded</span>
    <span class="n">wp</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="c1"># create events with enabled timing</span>
    <span class="n">e1</span> <span class="o">=</span> <span class="n">wp</span><span class="o">.</span><span class="n">Event</span><span class="p">(</span><span class="n">enable_timing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">e2</span> <span class="o">=</span> <span class="n">wp</span><span class="o">.</span><span class="n">Event</span><span class="p">(</span><span class="n">enable_timing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">n</span> <span class="o">=</span> <span class="mi">10000000</span>

    <span class="c1"># start timing...</span>
    <span class="n">wp</span><span class="o">.</span><span class="n">record_event</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">wp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">wp</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="n">inc</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>

    <span class="c1"># ...end timing</span>
    <span class="n">wp</span><span class="o">.</span><span class="n">record_event</span><span class="p">(</span><span class="n">e2</span><span class="p">)</span>

    <span class="c1"># get elapsed time between the two events</span>
    <span class="n">elapsed</span> <span class="o">=</span> <span class="n">wp</span><span class="o">.</span><span class="n">get_event_elapsed_time</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span>
</pre></div>
</div>
<p>The events must be created with the flag <code class="docutils literal notranslate"><span class="pre">enable_timing=True</span></code>.  The first event is recorded at the start of the timed code and the second event is recorded at the end.  The function <a class="reference internal" href="#warp.get_event_elapsed_time" title="warp.get_event_elapsed_time"><code class="xref py py-func docutils literal notranslate"><span class="pre">warp.get_event_elapsed_time()</span></code></a> is used to compute the time difference between the two events.  We must ensure that both events have completed on the device before calling <a class="reference internal" href="#warp.get_event_elapsed_time" title="warp.get_event_elapsed_time"><code class="xref py py-func docutils literal notranslate"><span class="pre">warp.get_event_elapsed_time()</span></code></a>.  By default, this function will synchronize on the second event using <a class="reference internal" href="#warp.synchronize_event" title="warp.synchronize_event"><code class="xref py py-func docutils literal notranslate"><span class="pre">warp.synchronize_event()</span></code></a>.  If that is not desired, the user may pass the <code class="docutils literal notranslate"><span class="pre">synchronize=False</span></code> flag and must use some other means of ensuring that both events have completed prior to calling the function.</p>
<p>Note that timing very short operations may yield inflated results, due to the timing resolution of CUDA events and the overhead of the profiling code.  In most cases, CUDA activity profiling with <code class="docutils literal notranslate"><span class="pre">ScopedTimer</span></code> will have less overhead and better precision.  For the most accurate results, a profiling tool such as Nsight Systems should be used.  The main benefit of using the manual event timing API is that it allows timing arbitrary sections of code rather than individual activities.</p>
</section>
<section id="profiling-api-reference">
<h2>Profiling API Reference<a class="headerlink" href="#profiling-api-reference" title="Link to this heading">#</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="warp.ScopedTimer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">warp.</span></span><span class="sig-name descname"><span class="pre">ScopedTimer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">active</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">print</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detailed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_nvtx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">color</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'rapids'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">synchronize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cuda_filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">report_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_tape</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/NVIDIA/warp/blob/v1.3.0/warp/utils.py#L612-L741"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#warp.ScopedTimer" title="Link to this definition">#</a></dt>
<dd><p>Context manager object for a timer</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – Name of timer</p></li>
<li><p><strong>active</strong> (<a class="reference internal" href="modules/functions.html#warp.bool" title="warp.bool"><em>bool</em></a>) – Enables this timer</p></li>
<li><p><strong>print</strong> (<a class="reference internal" href="modules/functions.html#warp.bool" title="warp.bool"><em>bool</em></a>) – At context manager exit, print elapsed time to sys.stdout</p></li>
<li><p><strong>detailed</strong> (<a class="reference internal" href="modules/functions.html#warp.bool" title="warp.bool"><em>bool</em></a>) – Collects additional profiling data using cProfile and calls <code class="docutils literal notranslate"><span class="pre">print_stats()</span></code> at context exit</p></li>
<li><p><strong>dict</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.12)"><em>dict</em></a>) – A dictionary of lists to which the elapsed time will be appended using <code class="docutils literal notranslate"><span class="pre">name</span></code> as a key</p></li>
<li><p><strong>use_nvtx</strong> (<a class="reference internal" href="modules/functions.html#warp.bool" title="warp.bool"><em>bool</em></a>) – If true, timing functionality is replaced by an NVTX range</p></li>
<li><p><strong>color</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><em>int</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – ARGB value (e.g. 0x00FFFF) or color name (e.g. ‘cyan’) associated with the NVTX range</p></li>
<li><p><strong>synchronize</strong> (<a class="reference internal" href="modules/functions.html#warp.bool" title="warp.bool"><em>bool</em></a>) – Synchronize the CPU thread with any outstanding CUDA work to return accurate GPU timings</p></li>
<li><p><strong>cuda_filter</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><em>int</em></a>) – Filter flags for CUDA activity timing, e.g. <code class="docutils literal notranslate"><span class="pre">warp.TIMING_KERNEL</span></code> or <code class="docutils literal notranslate"><span class="pre">warp.TIMING_ALL</span></code></p></li>
<li><p><strong>report_func</strong> (<em>Callable</em>) – A callback function to print the activity report (<code class="docutils literal notranslate"><span class="pre">wp.timing_print()</span></code> is used by default)</p></li>
<li><p><strong>skip_tape</strong> (<a class="reference internal" href="modules/functions.html#warp.bool" title="warp.bool"><em>bool</em></a>) – If true, the timer will not be recorded in the tape</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="warp.ScopedTimer.extra_msg">
<span class="sig-name descname"><span class="pre">extra_msg</span></span><a class="headerlink" href="#warp.ScopedTimer.extra_msg" title="Link to this definition">#</a></dt>
<dd><p>Can be set to a string that will be added to the printout at context exit.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)">str</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="warp.ScopedTimer.elapsed">
<span class="sig-name descname"><span class="pre">elapsed</span></span><a class="headerlink" href="#warp.ScopedTimer.elapsed" title="Link to this definition">#</a></dt>
<dd><p>The duration of the <code class="docutils literal notranslate"><span class="pre">with</span></code> block used with this object</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)">float</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="warp.ScopedTimer.timing_results">
<span class="sig-name descname"><span class="pre">timing_results</span></span><a class="headerlink" href="#warp.ScopedTimer.timing_results" title="Link to this definition">#</a></dt>
<dd><p>The list of activity timing results, if collection was requested using <code class="docutils literal notranslate"><span class="pre">cuda_filter</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.12)">list</a>[<a class="reference internal" href="#warp.TimingResult" title="warp.TimingResult">TimingResult</a>]</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="warp.get_event_elapsed_time">
<span class="sig-prename descclassname"><span class="pre">warp.</span></span><span class="sig-name descname"><span class="pre">get_event_elapsed_time</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_event</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_event</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">synchronize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/NVIDIA/warp/blob/v1.3.0/warp/context.py#L3875-L3896"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#warp.get_event_elapsed_time" title="Link to this definition">#</a></dt>
<dd><p>Get the elapsed time between two recorded events.</p>
<p>The result is in milliseconds with a resolution of about 0.5 microsecond.</p>
<p>Both events must have been previously recorded with <code class="docutils literal notranslate"><span class="pre">wp.record_event()</span></code> or <code class="docutils literal notranslate"><span class="pre">wp.Stream.record_event()</span></code>.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">synchronize</span></code> is False, the caller must ensure that device execution has reached <code class="docutils literal notranslate"><span class="pre">end_event</span></code>
prior to calling <code class="docutils literal notranslate"><span class="pre">get_event_elapsed_time()</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_event</strong> (<em>Event</em>) – The start event.</p></li>
<li><p><strong>end_event</strong> (<em>Event</em>) – The end event.</p></li>
<li><p><strong>synchronize</strong> (<a class="reference internal" href="modules/functions.html#warp.bool" title="warp.bool"><em>bool</em></a><em>, </em><em>optional</em>) – Whether Warp should synchronize on the <code class="docutils literal notranslate"><span class="pre">end_event</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="warp.synchronize_event">
<span class="sig-prename descclassname"><span class="pre">warp.</span></span><span class="sig-name descname"><span class="pre">synchronize_event</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/NVIDIA/warp/blob/v1.3.0/warp/context.py#L4844-L4854"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#warp.synchronize_event" title="Link to this definition">#</a></dt>
<dd><p>Synchronize the calling CPU thread with an event recorded on a CUDA stream.</p>
<p>This function allows the host application code to ensure that a specific synchronization point was reached.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>event</strong> (<em>Event</em>) – Event to wait for.</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="warp.TimingResult">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">warp.</span></span><span class="sig-name descname"><span class="pre">TimingResult</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">device</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">elapsed</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/NVIDIA/warp/blob/v1.3.0/warp/utils.py#L874-L892"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#warp.TimingResult" title="Link to this definition">#</a></dt>
<dd><p>Timing result for a single activity.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>raw_result</strong> (<em>warp.utils.timing_result_t</em>) – The result structure obtained from C++ (internal use only)</p>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="warp.TimingResult.device">
<span class="sig-name descname"><span class="pre">device</span></span><a class="headerlink" href="#warp.TimingResult.device" title="Link to this definition">#</a></dt>
<dd><p>The device where the activity was recorded.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>warp.Device</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="warp.TimingResult.name">
<span class="sig-name descname"><span class="pre">name</span></span><a class="headerlink" href="#warp.TimingResult.name" title="Link to this definition">#</a></dt>
<dd><p>The activity name.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)">str</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="warp.TimingResult.filter">
<span class="sig-name descname"><span class="pre">filter</span></span><a class="headerlink" href="#warp.TimingResult.filter" title="Link to this definition">#</a></dt>
<dd><p>The type of activity (e.g., <code class="docutils literal notranslate"><span class="pre">warp.TIMING_KERNEL</span></code>).</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)">int</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="warp.TimingResult.elapsed">
<span class="sig-name descname"><span class="pre">elapsed</span></span><a class="headerlink" href="#warp.TimingResult.elapsed" title="Link to this definition">#</a></dt>
<dd><p>The elapsed time in milliseconds.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)">float</a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="warp.timing_begin">
<span class="sig-prename descclassname"><span class="pre">warp.</span></span><span class="sig-name descname"><span class="pre">timing_begin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cuda_filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4294967295</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">synchronize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/NVIDIA/warp/blob/v1.3.0/warp/utils.py#L894-L906"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#warp.timing_begin" title="Link to this definition">#</a></dt>
<dd><p>Begin detailed activity timing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cuda_filter</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><em>int</em></a>) – Filter flags for CUDA activity timing, e.g. <code class="docutils literal notranslate"><span class="pre">warp.TIMING_KERNEL</span></code> or <code class="docutils literal notranslate"><span class="pre">warp.TIMING_ALL</span></code></p></li>
<li><p><strong>synchronize</strong> (<a class="reference internal" href="modules/functions.html#warp.bool" title="warp.bool"><em>bool</em></a>) – Whether to synchronize all CUDA devices before timing starts</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="warp.timing_end">
<span class="sig-prename descclassname"><span class="pre">warp.</span></span><span class="sig-name descname"><span class="pre">timing_end</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">synchronize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/NVIDIA/warp/blob/v1.3.0/warp/utils.py#L908-L952"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#warp.timing_end" title="Link to this definition">#</a></dt>
<dd><p>End detailed activity timing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>synchronize</strong> (<a class="reference internal" href="modules/functions.html#warp.bool" title="warp.bool"><em>bool</em></a>) – Whether to synchronize all CUDA devices before timing ends</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of <code class="docutils literal notranslate"><span class="pre">TimingResult</span></code> objects for all recorded activities.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.12)">list</a>[<a class="reference internal" href="#warp.TimingResult" title="warp.TimingResult">TimingResult</a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="warp.timing_print">
<span class="sig-prename descclassname"><span class="pre">warp.</span></span><span class="sig-name descname"><span class="pre">timing_print</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">results</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indent</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/NVIDIA/warp/blob/v1.3.0/warp/utils.py#L954-L1018"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#warp.timing_print" title="Link to this definition">#</a></dt>
<dd><p>Print timing results.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>results</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.12)"><em>list</em></a><em>[</em><a class="reference internal" href="#warp.TimingResult" title="warp.TimingResult"><em>TimingResult</em></a><em>]</em>) – List of <code class="docutils literal notranslate"><span class="pre">TimingResult</span></code> objects.</p></li>
<li><p><strong>indent</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – Optional indentation for the output.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="modules/runtime.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Runtime Reference</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="modules/concurrency.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Concurrency</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022-2024, NVIDIA Corporation
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/NVIDIA/warp" aria-label="GitHub">
            <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
            </svg>
        </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Profiling</a><ul>
<li><a class="reference internal" href="#scopedtimer">ScopedTimer</a></li>
<li><a class="reference internal" href="#cuda-activity-profiling">CUDA Activity Profiling</a><ul>
<li><a class="reference internal" href="#customizing-the-output">Customizing the output</a></li>
<li><a class="reference internal" href="#using-the-activity-timing-functions-directly">Using the activity timing functions directly</a></li>
<li><a class="reference internal" href="#limitations">Limitations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-cuda-events">Using CUDA Events</a></li>
<li><a class="reference internal" href="#profiling-api-reference">Profiling API Reference</a><ul>
<li><a class="reference internal" href="#warp.ScopedTimer"><code class="docutils literal notranslate"><span class="pre">ScopedTimer</span></code></a><ul>
<li><a class="reference internal" href="#warp.ScopedTimer.extra_msg"><code class="docutils literal notranslate"><span class="pre">ScopedTimer.extra_msg</span></code></a></li>
<li><a class="reference internal" href="#warp.ScopedTimer.elapsed"><code class="docutils literal notranslate"><span class="pre">ScopedTimer.elapsed</span></code></a></li>
<li><a class="reference internal" href="#warp.ScopedTimer.timing_results"><code class="docutils literal notranslate"><span class="pre">ScopedTimer.timing_results</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#warp.get_event_elapsed_time"><code class="docutils literal notranslate"><span class="pre">get_event_elapsed_time()</span></code></a></li>
<li><a class="reference internal" href="#warp.synchronize_event"><code class="docutils literal notranslate"><span class="pre">synchronize_event()</span></code></a></li>
<li><a class="reference internal" href="#warp.TimingResult"><code class="docutils literal notranslate"><span class="pre">TimingResult</span></code></a><ul>
<li><a class="reference internal" href="#warp.TimingResult.device"><code class="docutils literal notranslate"><span class="pre">TimingResult.device</span></code></a></li>
<li><a class="reference internal" href="#warp.TimingResult.name"><code class="docutils literal notranslate"><span class="pre">TimingResult.name</span></code></a></li>
<li><a class="reference internal" href="#warp.TimingResult.filter"><code class="docutils literal notranslate"><span class="pre">TimingResult.filter</span></code></a></li>
<li><a class="reference internal" href="#warp.TimingResult.elapsed"><code class="docutils literal notranslate"><span class="pre">TimingResult.elapsed</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#warp.timing_begin"><code class="docutils literal notranslate"><span class="pre">timing_begin()</span></code></a></li>
<li><a class="reference internal" href="#warp.timing_end"><code class="docutils literal notranslate"><span class="pre">timing_end()</span></code></a></li>
<li><a class="reference internal" href="#warp.timing_print"><code class="docutils literal notranslate"><span class="pre">timing_print()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=1f29e9d3"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=fd10adb8"></script>
    </body>
</html>